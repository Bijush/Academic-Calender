const holidays = {
  "2025-01-14": "মাঘ বিহু",
  "2025-01-15": "তুসু পূজা",
  "2025-01-23": "নেতাজি সুভাষচন্দ্র বসুর জন্মদিন",
  "2025-01-26": "প্রজাতন্ত্র দিবস",
  "2025-01-28": "গুথার বাথৌ সান",
  "2025-01-31": "মে-দাম-মে-ফি",
  "2025-02-12": "বীর চিলারায় দিবস",
  "2025-03-14": "দোল যাত্রা",
  "2025-03-31": "ইদ-উল-ফিতর",
  "2025-04-01": "বার্ষিক হিসাব বন্ধ (ব্যাংক ছুটি)",
  "2025-04-14": "বোহাগ বিহু (প্রথম দিন)",
  "2025-04-15": "বোহাগ বিহু (দ্বিতীয় দিন)",
  "2025-04-16": "বোহাগ বিহু (তৃতীয় দিন)",
  "2025-04-18": "গুড ফ্রাইডে",
  "2025-04-21": "সতী সাধনী দিবস",
  "2025-04-28": "দামোদরদেৱৰ তিথি",
  "2025-05-01": "মে দিবস",
  "2025-05-12": "বুদ্ধ পূর্ণিমা",
  "2025-06-07": "ইদ-উল-জুহা",
  "2025-06-12": "শ্ৰী শ্ৰী মাধবদেৱৰ জন্মতিথি",
  "2025-07-06": "মুহাররম (অর্ধদিবস)",
  "2025-08-15": "স্বাধীনতা দিবস",
  "2025-08-25": "শ্ৰীমন্ত শংকৰদেৱৰ তিথি",
  "2025-09-03": "কৰম পূজা",
  "2025-09-12": "শ্ৰী শ্ৰী মাধবদেৱৰ তিৰোভাব তিথি",
  "2025-09-14": "জন্মাষ্টমী",
  "2025-09-29": "দুৰ্গা পূজা (মহা সপ্তমী)",
  "2025-09-30": "দুৰ্গা পূজা (মহা অষ্টমী)",
  "2025-10-01": "দুৰ্গা পূজা (মহা নবমী)",
  "2025-10-02": "বিজয়া দশমী / গান্ধী জয়ন্তী / শ্ৰীমন্ত শংকৰদেৱৰ জন্মতিথি",
  "2025-10-18": "কাৰ্তিক বিহু",
  "2025-10-20": "কালী পূজা ও দীপাৱলী",
  "2025-10-23": "ভাতৃ দ্বিতীয়া",
  "2025-10-28": "ছট পূজা",
  "2025-11-05": "গুরু নানক জন্মদিন",
  "2025-11-24": "লাচিত দিবস",
  "2025-12-02": "অসম দিবস (চুকাফা দিবস)",
  "2025-12-25": "বড়দিন",
  "2026-01-14": "মাঘ বিহু",
  "2026-01-15": "তুসু পূজা",
  "2026-01-23": "নেতাজি সুভাষচন্দ্র বসুর জন্মদিন",
  "2026-01-26": "প্রজাতন্ত্র দিবস",
  "2026-01-27": "গুথার বাথৌ সান",
  "2026-01-31": "মে-দাম-মে-ফি",
  "2026-02-01": "বীর চিলারায় দিবস",
  "2026-03-02": "দোল যাত্রা",
  "2026-03-21": "ইদ-উল-ফিতর",
  "2026-04-01": "বার্ষিক হিসাব বন্ধ (ব্যাংক ছুটি)",
  "2026-04-03": "গুড ফ্রাইডে",
  "2026-04-14": "বোহাগ বিহু",
  "2026-04-15": "বোহাগ বিহু (দ্বিতীয় দিন)",
  "2026-05-01": "মে দিবস",
  "2026-05-27": "ইদ-উল-জুহা",
  "2026-08-15": "স্বাধীনতা দিবস",
  "2026-10-02": "গান্ধী জয়ন্তী",
  "2026-10-18": "মহা সপ্তমী",
  "2026-10-19": "মহা অষ্টমী",
  "2026-10-20": "মহা নবমী",
  "2026-10-21": "বিজয়া দশমী",
  "2026-11-08": "দীপাবলি / কালী পূজা",
  "2026-11-24": "গুরু নানক জন্মদিন",
  "2026-12-25": "বড়দিন"
};

    const celebrations = {
      "2025-04-07": ["বিশ্ব স্বাস্থ্য দিবস"],
       "2026-04-07": ["বিশ্ব স্বাস্থ্য দিবস"],
       
       "2025-4-22": ["ধরিত্রী দিবস"],
       "2026-4-22": ["ধরিত্রী দিবস"],
       
       "2025-4-25": ["বিশ্ব ম্যালেরিয়া দিবস"],
       "2026-4-25": ["বিশ্ব ম্যালেরিয়া দিবস"],
       
        "2025-5-9": ["রবীন্দ্র জয়ন্তী"],
        "2026-5-9": ["রবীন্দ্র জয়ন্তী"],
       
  "2025-5-19": ["ভাষা শহীদ দিবস"],
  "2026-5-19": ["ভাষা শহীদ দিবস"],
  
  "2025-5-28": ["মহেকীয় স্বাস্থ্যবিদি সাজাগতা দিবস"],
  "2026-5-28": ["মহেকীয় স্বাস্থ্যবিদি সাজাগতা দিবস"],
  
  "2025-06-05": ["বিশ্ব পরিবেশ দিবস"],
  "2026-06-05": ["বিশ্ব পরিবেশ দিবস"],
  
  "2025-06-20": ["কালাগুরু বিষ্ণুরভা দিবস"],
  "2025-06-20": ["কালাগুরু বিষ্ণুরভা দিবস"],
  
  "2025-06-21": ["আন্তর্জাতিক যোগ দিবস"],
    "2026-06-21": ["আন্তর্জাতিক যোগ দিবস"],
    
      "2025-9-05": ["শিক্ষক দিবস"],
      "2026-9-05": ["শিক্ষক দিবস"],
      
      "2025-9-08": ["বিশ্ব সাক্ষরতা দিবস"],
      "2026-9-08": ["বিশ্ব সাক্ষরতা দিবস"],
      
      "2025-11-14": ["শিশু দিবস", "বিনোদন উৎসব"],
      "2026-11-14": ["শিশু দিবস", "বিনোদন উৎসব"],
      
      "2025-10-06": ["লক্ষ্মী পূজা", "অর্ধ দিবস"],
      "2025-10-06": ["লক্ষ্মী পূজা", "অর্ধ দিবস"],
      
       "2025-10-06": ["বিশ্ব দুর্যোগ দিবস "],
       "2026-10-06": ["বিশ্ব দুর্যোগ দিবস "],
       
       "2025-10-14": ["লক্ষীনাথ বেজবুরুয়া জন্ম জয়ন্তী"],
        "2026-10-14": ["লক্ষীনাথ বেজবুরুয়া জন্ম জয়ন্তী"]
      
      
    };

    const examDates = {
      "2025-06-18": "First Formative Assessment",
      "2025-06-19": "First Formative Assessment",
      "2025-06-23": "First Formative Assessment",
      "2025-06-24": "First Formative Assessment",
      "2025-06-25": "First Formative Assessment",
      "2025-06-26": "First Formative Assessment",
      "2025-06-27": "First Formative Assessment",
      "2025-06-28": "First Formative Assessment",
      "2025-12-01": "Unit Test",
      "2026-02-10": "Final পরীক্ষা"
    };

    const preparationDays = {
      "2025-08-14": "পরীক্ষা প্রস্তুতি দিন",
      "2026-02-09": "বার্ষিক প্রস্তুতি দিন"
    };

    const resultDays = {
      "2025-09-25": "Mid Term ফলাফল",
      "2026-03-15": "Final ফলাফল প্রকাশ"
    };

    const monthNames = [
      "APRIL", "MAY", "JUNE", "JULY", "AUGUST", "SEPTEMBER",
      "OCTOBER", "NOVEMBER", "DECEMBER", "JANUARY", "FEBRUARY", "MARCH"
    ];

    const examDetails = {
      "2025-06-18": {
        name: "First Formative Assessment",
        subjects: ["Day 1"],
        time: " 9AM to 12PM"
      },
      "2025-06-19": {
        name: "First Formative Assessment",
        subjects: ["DAY 2"],
        time: "10:00 AM - 12:00 PM"},
        
        "2025-06-23": {
        name: "First Formative Assessment",
        subjects: ["DAY 3"],
        time: "10:00 AM - 12:00 PM"
        },
        
        "2025-06-24": {
        name: "First Formative Assessment",
        subjects: ["DAY 4"],
        time: "10:00 AM - 12:00 PM"
        },
        
        "2025-06-25": {
        name: "First Formative Assessment",
        subjects: ["DAY 5"],
        time: "10:00 AM - 12:00 PM"
        },
        
        "2025-06-26": {
        name: "First Formative Assessment",
        subjects: ["DAY 6"],
        time: "10:00 AM - 12:00 PM"
        },
        
        "2025-06-27": {
        name: "First Formative Assessment",
        subjects: ["DAY 7"],
        time: "10:00 AM - 12:00 PM"
        },
        
        "2025-06-28": {
        name: "First Formative Assessment",
        subjects: ["DAY 8"],
        time: "10:00 AM - 12:00 PM"
        },
        
        "2025-06-29": {
        name: "First Formative Assessment",
        subjects: ["DAY 9"],
        time: "10:00 AM - 12:00 PM"
      },
      
      "2025-12-01": {
        name: "Unit Test",
        subjects: ["English", "Math"],
        time: "10:00 AM - 12:00 PM"
      },
      
      "2026-02-10": {
        name: "Final পরীক্ষা",
        subjects: ["All Subjects"],
        time: "9:00 AM - 12:30 PM"
      }
    };

    // For storing events from user input
    // Events are stored in localStorage with key "calendarEvents" as a JSON object:
    // { "YYYY-MM-DD": { title: "…", description: "…" }, ... }
    let calendarEvents = JSON.parse(localStorage.getItem("calendarEvents")) || {};

    // Global variable to track the currently selected date key for the modal
    let selectedDateKey = "";

    // Populate month and year dropdowns
    const monthSelect = document.getElementById("month");
    const yearSelect = document.getElementById("year");

    for (let i = 0; i < 12; i++) {
      const option = document.createElement("option");
      // Adjusting the month value as in your original code:
      option.value = (i + 3) % 12;
      option.textContent = monthNames[i];
      monthSelect.appendChild(option);
    }

    const today = new Date();
    const currentYear = today.getFullYear();
    for (let y = currentYear - 1; y <= currentYear + 1; y++) {
      const option = document.createElement("option");
      option.value = y;
      option.textContent = `${y}-${y + 1}`;
      yearSelect.appendChild(option);
    }

    let defaultMonth = today.getMonth();
    let academicYear = today.getFullYear();
    if (defaultMonth < 3) academicYear--;
    monthSelect.value = defaultMonth;
    yearSelect.value = academicYear;

  
    // Render the calendar grid
    
    
    function renderCalendar() {
      let month = parseInt(monthSelect.value);
      let year = parseInt(yearSelect.value);
      if (month < 3) year += 1;

      const firstDay = new Date(year, month, 1);
      const startDay = firstDay.getDay();
      const numDays = new Date(year, month + 1, 0).getDate();

      const calendarBody = document.getElementById("calendar-body");
      const summaryList = document.getElementById("summary-list");
      const examDetailsContainer = document.getElementById("exam-details");
      calendarBody.innerHTML = "";
      summaryList.innerHTML = "";
      examDetailsContainer.innerHTML = "";

      let date = 1;
      let sundays = 0, holidayCount = 0, classDays = 0, obsCount = 0;
      const holidayList = [];
      const monthlyExamList = [];

      for (let r = 0; r < 6; r++) {
        const row = document.createElement("tr");
        for (let c = 0; c < 7; c++) {
          const td = document.createElement("td");

          if ((r === 0 && c < startDay) || date > numDays) {
            td.innerHTML = "";
          } else {
            const key = `${year}-${String(month + 1).padStart(2, "0")}-${String(date).padStart(2, "0")}`;
            td.innerHTML = `<strong>${date}</strong><br>`;

            let isHoliday = false, isObs = false;

            // Show exam badge if applicable
            if (examDates[key]) {
              td.classList.add("exam");
              td.innerHTML += `<div class="badge-exam">${examDates[key]}</div>`;
              const examInfo = examDetails[key];
              if (examInfo) {
                monthlyExamList.push(`${date} - ${examInfo.name} (${examInfo.subjects.join(", ")}) - ${examInfo.time}`);
              }
            }

            // Show holiday badge if applicable
            if (holidays[key]) {
              td.classList.add("holiday");
              td.innerHTML += `<div class="badge-holiday">বন্ধ বার<br>${holidays[key]}</div>`;
              isHoliday = true;
              holidayList.push(`${date} - ${holidays[key]}`);
              holidayCount++;
            }

            if (c === 0) {
              td.classList.add("sunday");
              td.innerHTML += "<br>রবিবার";
              sundays++;
            }

            // Show celebration badge if applicable
            if (celebrations[key]) {
              celebrations[key].forEach(ev => {
                td.innerHTML += `<div class="badge-event">🎉 ${ev}</div>`;
                isObs = true;
              });
            }

            // Show preparation and result badges if applicable
            if (preparationDays[key]) {
              td.innerHTML += `<div class="badge-preparation">${preparationDays[key]}</div>`;
            }
            if (resultDays[key]) {
              td.innerHTML += `<div class="badge-result">${resultDays[key]}</div>`;
            }

            // Example: Special summer vacation handling for July (month index 6)
            const isJuly = (month === 6);
            if (isJuly && c !== 0) {
              td.classList.add("holiday");
              td.innerHTML += `<div class="badge-holiday">গ্রীষ্ম বন্ধ</div>`;
              holidayList.push(`${date} - গ্রীষ্ম বন্ধ`);
              holidayCount++;
            } else if (!isHoliday && c !== 0 && !examDates[key]) {
              td.classList.add("class-day");
              td.innerHTML += `<div class="badge-class">শ্রেণী দিন</div>`;
              
              
              
              
              
              
              classDays++;
              
            }

            if (isObs) obsCount++;

            // Mark today if applicable
            
            if (
  today.getDate() === date &&
  today.getMonth() === month &&
  today.getFullYear() === year
) {
  td.classList.add("today");
  td.innerHTML += ' 🌟'; // Adds a star emoji next to the date
}


            // If an event was saved by the user for this date, show its badge
            if (calendarEvents[key]) {
              td.innerHTML += `<div class="badge-event">${calendarEvents[key].title}</div>`;
            }

            // Attach a tooltip (optional)
            const tooltipText =
              [holidays[key], ...(celebrations[key] || []), examDates[key], preparationDays[key], resultDays[key]]
              .filter(Boolean)
              .join(", ");
            if (tooltipText) td.dataset.tooltip = tooltipText;

            // Bind click event to open modal with the date key
            

            date++;
          }
          row.appendChild(td);
        }
        calendarBody.appendChild(row);
      }

      // Update summary details
      if (holidayList.length > 0) {
        summaryList.innerHTML += `<li><strong>এই মাসের ছুটি:</strong><ul>${holidayList.map(h => `<li>${h}</li>`).join("")}</ul></li>`;
      }
      summaryList.innerHTML += `<li><strong>মোট রবিবার:</strong> ${sundays}</li>`;
      summaryList.innerHTML += `<li><strong>মোট ছুটি:</strong> ${holidayList.length}</li>`;
      summaryList.innerHTML += `<li><strong>মোট শ্রেণী দিন:</strong> ${classDays}</li>`;
      summaryList.innerHTML += `<li><strong>মোট পালনীয় দিবস:</strong> ${obsCount}</li>`;

      if (monthlyExamList.length > 0) {
        examDetailsContainer.innerHTML = `<h3>এই মাসের পরীক্ষাসমূহ:</h3><ul>${monthlyExamList.map(e => `<li>${e}</li>`).join("")}</ul>`;
      }
    }

    monthSelect.addEventListener("change", renderCalendar);
    yearSelect.addEventListener("change", renderCalendar);

    // Tooltip functionality
    const tooltip = document.getElementById("custom-tooltip");
    document.addEventListener("click", function(e) {
      const td = e.target.closest("td");
      if (td && td.dataset.tooltip) {
        if (tooltip.style.display === "block" && tooltip.innerText === td.dataset.tooltip) {
          tooltip.style.display = "none";
        } else {
          tooltip.innerText = td.dataset.tooltip;
          tooltip.style.display = "block";
          tooltip.style.left = (e.pageX + 15) + "px";
          tooltip.style.top = (e.pageY + 15) + "px";
        }
      } else {
        tooltip.style.display = "none";
      }
    });
    


    renderCalendar();